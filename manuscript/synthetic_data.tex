\section{Application to synthetic data}

Our convolutional equivalent layer method requires a regular data grid located on a 
horizontal and flat observation surface.
Here, we evaluate the performance of our method by applying it to simulated airborne magnetic 
surveys formed by
i) a regular data grid on a flat surface;
ii) irregular data grids on a flat surface; and 
iii) regular data grid on undulating surfaces.
Note that the simulated surveys in (ii) and (iii) violate the premises of our method. 

%=======================================
\subsection*{Simulated airborne surveys}
%=======================================

The upper and middle rows in Figure \ref{fig:synthetic_data_comparison_v2} show, respectively, 
the simulated flight patterns and noise-corrupted total-field anomalies of the airborne magnetic 
surveys used in our tests. The lower row in Figure \ref{fig:synthetic_data_comparison_v2} shows 
the true upward-continued total-field anomalies at $z = -1, \, 300$ m.
All magnetic data (middle and lower rows in Figure \ref{fig:synthetic_data_comparison_v2}) 
are produced by the same three synthetic bodies: two prisms and one sphere with 
constant total-magnetization vector having inclination, declination and intensity of 
$0^{\circ}$, $45^{\circ}$, and $2.8284$ A/m, respectively. 
The simulated main geomagnetic field has inclination and declination of $10^{\circ}$ and $37^{\circ}$,
respectively. 

%% regular grid on a flat surface

Figure \ref{fig:synthetic_data_comparison_v2}a shows the simulated airborne survey on
a regular grid of $100 \times 50$ observation points (totaling  $N = 5,\, 000$ observation points),
with a grid spacing of $\Delta x = 101.01$ m and $\Delta y = 163.265$ m along the
$x$- and $y$-axis, respectively.
The noise-corrupted total-field anomaly (middle panel) is calculated at $z = -900$ m, with a
pseudorandom Gaussian noise having null mean and standard deviation of $0.2961$ nT.

%% irregular grids on a flat surface

Figures \ref{fig:synthetic_data_comparison_v2}b and \ref{fig:synthetic_data_comparison_v2}c 
show the simulated surveys on irregular grids obtained by perturbing the horizontal coordinates
of the regular grid (upper panel in Figure \ref{fig:synthetic_data_comparison_v2}a).
For the survey shown in Figure \ref{fig:synthetic_data_comparison_v2}b, the $x$ and $y$ coordinates 
are perturbed with sequences of pseudorandom Gaussian noises having null mean and standard deviations
equal to $20\%$ of the corresponding grid spacing, which results in
absolute values of $20.2$ m and $32.6$ m, along the $x$- and $y$-directions, respectively.
For the survey shown in Figure \ref{fig:synthetic_data_comparison_v2}c, the standard deviations
are equal to $30\%$ of the corresponding grid spacing, which results in absolute values of 
$30.3$ m and $49.0$ m along the $x$- and $y$-directions, respectively.
Their noise-corrupted total-field anomalies (middle panels in Figures 
\ref{fig:synthetic_data_comparison_v2}b and \ref{fig:synthetic_data_comparison_v2}c) are calculated 
on their corresponding irregular grids, on a flat observation surface at $z = -900$ m, 
with a pseudorandom Gaussian noise having null mean and standard deviation of $0.2961$ nT.

%% regular grid on undulating surfaces

Figures \ref{fig:synthetic_data_comparison_v2}d and \ref{fig:synthetic_data_comparison_v2}e 
show the simulated surveys on the same regular grid shown in Figure 
\ref{fig:synthetic_data_comparison_v2}a (upper panel). The difference is that 
they are no longer on a flat, but on undulating surfaces.
For the survey shown in Figure \ref{fig:synthetic_data_comparison_v2}d, the $z$ coordinates 
of the undulating surface are defined by a sequence of pseudorandom Gaussian noise having mean 
$-900$ m and standard deviation equal to $5\%$ of $900$ m, which corresponds to $45$ m.
For the survey shown in Figure \ref{fig:synthetic_data_comparison_v2}e, the standard deviation 
is equal to $10\%$ of $900$ m, which corresponds to $90$ m.
The noise-corrupted total-field anomalies of these simulated surveys (middle panels in Figures 
\ref{fig:synthetic_data_comparison_v2}d and \ref{fig:synthetic_data_comparison_v2}e) are calculated 
on their corresponding undulating surfaces (upper panels in Figures 
\ref{fig:synthetic_data_comparison_v2}d and \ref{fig:synthetic_data_comparison_v2}e),
on the same regular grid shown in Figure \ref{fig:synthetic_data_comparison_v2}a,
with a pseudorandom Gaussian noise having null mean and standard deviation of $0.2961$ nT.


%% Regular grid
%======================================================================================
\subsection*{Tests with a regular data grid on a flat surface}
%======================================================================================

Figure \ref{fig:synthetic_residuals_convergence_comparison_v2} show the 
difference between the simulated (middle row in Figure \ref{fig:synthetic_data_comparison_v2})
and predicted data (not shown) obtained by using the classical (the upper row) and 
our method (the middle row). From now on, we designate this difference as data residuals. 
The lower row in Figure \ref{fig:synthetic_residuals_convergence_comparison_v2} shows the 
convergence curve of our method.

The data residuals using the classical method (equation \ref{eq:classical-method})  
are shown in the upper panel of Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}a, 
with mean $0.3627$ nT and standard deviation $0.2724$ nT. This process took $17.10$ seconds.
Using our method, the data residuals (the middle panel in Figure
\ref{fig:synthetic_residuals_convergence_comparison_v2}a) have mean $0.5223$ nT and standard
deviation $0.4323$ nT. In this case, however, the processing time was only $0.18$ seconds.
As expected, the Euclidean norm of the data residuals produced by our method 
(lower panel in Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}a) decreases 
and the convergence criterion is satisfied close to iteration $50$. 
This result shows that, in practice, our method converges way before $N$ iterations,
where $N$ is the number of observations.
Setting the convergence to $N$ iterations, besides being unnecessary, it also demands a larger 
computer processing time, even in this synthetic test with a small number 
of $N = 5,\, 000$ observations.

%======================================================================================
\subsection*{Tests with irregular data grids on a flat surface}
%======================================================================================

Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}b shows the results obtained
with the irregular data grid perturbed by using $20\%$ of the regular grid spacing.
In this Figure we can see that the data residuals 
using the classical method (upper panel) yield a good data fit with mean $0.3630$ nT and standard
deviation $0.2731$ nT. 
Using our method, the data residuals (middle panel in Figure 
\ref{fig:synthetic_residuals_convergence_comparison_v2}b) also produced an acceptable data 
fitting with mean of  $0.7147$ nT and standard deviation of $0.5622$ nT. 
The Euclidean norm of the data residuals obtained by our method 
(lower panel in Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}b) decreases, 
as expected, and converges to a constant value close to iteration $50$. 

Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}b shows the results obtained
with the irregular data grid perturbed by using $30\%$ of the regular grid spacing.
This figure shows that the data residuals 
obtained by the classical method (upper panel) produced an acceptable data fitting, having mean 
$0.3634$ nT and standard deviation $0.2735$ nT. 
%Using our method, the data residuals (middle panel in Figure 
%\ref{fig:synthetic_residuals_convergence_comparison_v2}c) with mean $0.9788$ nT and 
%standard deviation $0.7462$ nT produced a worse data fitting.
%The convergence of our method (lower panel in Figure 
%\ref{fig:synthetic_residuals_convergence_comparison_v2}c) shows that, 
%similarly to the previous results, the Euclidean norm of the residuals decreases; however it starts
%increasing without achieving an invariance. Hence, the convergence is not achieved. 
%
%\textbf{Alternative text} $\rightarrow$
%
Using our method, the data residuals (middle panel in Figure 
\ref{fig:synthetic_residuals_convergence_comparison_v2}c) with mean $0.9186$ nT and 
standard deviation $0.7354$ nT also produced a good data fitting.
The convergence of our method (lower panel in Figure 
\ref{fig:synthetic_residuals_convergence_comparison_v2}c) shows that, 
similarly to the previous results, the Euclidean norm of the residuals decreases; however it starts
increasing without achieving an invariance. In this case, we have to stop the algorithm
at iteration $40$. Note that this good result was obtained by using a very perturbed
data grid (upper panel in Figure \ref{fig:synthetic_data_comparison_v2}c).
%
%$\leftarrow$ \textbf{Alternative text}

%======================================================================================
\subsection*{Tests with regular data grid an undulating surfaces}
%======================================================================================

Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}d shows the results obtained
with data on the undulating surface varying $5\%$ of $z = 900$ m.
In this case, the data residuals either using the classical method 
(upper panel in Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}d) or
our method (middle panel in Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}d) reveal
acceptable data fittings.
Using the classical method, data residuals have mean $0.3712$ nT and standard deviation $0.2870$ nT.
Using our method, they have mean $0.9542$ nT and standard deviation $0.8943$ nT. 
Likewise, the Euclidean norm of the data residuals produced by our method 
(lower panel in Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}d) decreases up to 
iteration 50 and reaches an invariance in the subsequent iterations.

Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}e shows the results obtained
with data on the undulating surface varying $10\%$ of $z = 900$ m.
By using the classical approach, the data residuals (upper panel in 
Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}e) 
yielded a good data fitting, with mean $0.3865$ nT and standard deviation $0.3216$ nT. 
By using our method, the data residuals (middle panel in 
Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}e) yielded a worse data fitting 
with mean $1.6109$ nT and standard deviation $1.6231$ nT.
The convergence curve (lower panel in Figure \ref{fig:synthetic_residuals_convergence_comparison_v2}e)
reveals the inadequacy of our method in dealing with observations on rugged surfaces, as 
the Euclidean norm of the data residuals decreases slower than in previous tests. 
We stress that, in this test, the undulating surface (upper panel in Figure 
\ref{fig:synthetic_data_comparison_v2}e) varies in a broad range from $z = - 570$ m to about 
$z = -1,\, 230$ m. Thus, this simulated airborne magnetic survey greatly violates the requirement 
of a flat observation surface demanded by our method.

Although our method is formulated to deal with magnetic observations measured on 
a horizontally regular grid, on a flat surface, the results obtained with synthetic 
data show that our method is robust in dealing either with irregular grids in the 
horizontal directions or with uneven surfaces.
However, the robustness of our method has limitations.
The performance limitation of our method depends on the degree of 
departure of the (i) $x$- and $y$-coordinates from those of the closest 
regular grid and (ii) the $z$ coordinates from a constant value.
High departures in the $x$-, $y$, and $z$-coordinates lead to unacceptable 
data fittings (large data residuals), as shown the middle panels in Figures 
\ref{fig:synthetic_residuals_convergence_comparison_v2}c and
\ref{fig:synthetic_residuals_convergence_comparison_v2}e.

%======================================================================================
\subsection*{Magnetic data processing}
%======================================================================================

We performed the upward continuations of the synthetic total-field anomalies 
(middle row in Figure \ref{fig:synthetic_data_comparison_v2}) by using 
the classical method, our convolutional equivalent layer method, and 
the classical approach in the Fourier domain,
which consists in computing the Fourier transform of the total-field anomaly 
\citep[e.g.,][ p. 317]{blakely1996}. 

Figure \ref{fig:synthetic_upward_residuals_comparison_v2} shows the differences
between the true upward-continued total-field anomalies (lower row in Figure
\ref{fig:synthetic_data_comparison_v2}) and the predicted upward-continued total-field 
anomalies (not shown). We conveniently denote these differences as continuation
residuals.

%% Classical and our method 

Figure \ref{fig:synthetic_upward_residuals_comparison_v2} shows that the continuation residuals 
obtained by using the classical method (upper row) and our method (middle row) are 
similar to each other in most of the tests.
One exception is the synthetic test with data over an undulating surface 
(Figures \ref{fig:synthetic_data_comparison_v2}e and 
\ref{fig:synthetic_residuals_convergence_comparison_v2}e), which greatly violates the 
requirement of a flat observation surface demanded by our method.
Note that the maximum absolute value of the continuation residuals produced by using our 
method (middle panel in Figure \ref{fig:synthetic_upward_residuals_comparison_v2}e) 
are $\approx 2.5$ times greater than those produced by the classical method 
(upper panel in Figure \ref{fig:synthetic_upward_residuals_comparison_v2}e).
Besides, they are generally concentrated at the boundaries of the study area.

%%  Fourier 

In contrast, the continuation residuals obtained by using the 
classical Fourier approach (lower row in Figure \ref{fig:synthetic_upward_residuals_comparison_v2})
are, in most of the tests, approximately $6$ times greater than those produced by the classical method 
(upper row in Figure \ref{fig:synthetic_upward_residuals_comparison_v2}) and $4$ times greater than
those produced by our method (middle row in Figure \ref{fig:synthetic_upward_residuals_comparison_v2}).
Note that, similarly to our method, the maximum absolute values of the continuation residuals 
obtained by using the classical Fourier approach are located at the boundaries of the simulated area.
However, the values are significantly higher.

We call attention to the following aspects:
In applying the classical method, our method, or the classical Fourier approach, we do not expand 
the data by using a padding scheme.
The data residuals (upper and middle rows in Figure 
\ref{fig:synthetic_residuals_convergence_comparison_v2}) 
and the continuation residuals (Figure \ref{fig:synthetic_upward_residuals_comparison_v2}) are
shown without removing the edge effects. 
The computational time required by our method is much lower than that required by the classical method
and has the same order of magnitude of that required by the classical Fourier approach.
However, the classical Fourier approach shows upward-continued data with strong border effects 
if no padding scheme is applied to expand the data. 


