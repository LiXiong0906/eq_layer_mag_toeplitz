\renewcommand{\figdir}{Fig} % figure directory

%% Methodology
%\plot{Figure1}{width=\textwidth}{
%	{Schematic representation of an $N_{x} \times N_{y}$ regular grid of points (black dots) defined by 
%	$N_{x} = 4$ and $N_{y} = 3$. The grids are oriented along the (a) $x$-axis and (b) $y$-axis. The grid 
%	coordinates are $x_{k}$ and $y_{l}$, where the $k = 1, \dots, N_{x}$ and $l = 1, \dots, N_{y}$ are 
%	called the grid indices. The insets show the grid indices $k$ and $l$.}
%	\label{fig:methodology}
%}

\plot{schematic_regular_grids}{width=\textwidth}{
	{Schematic representation of an $N_{x} \times N_{y}$ regular grid of points (black dots) with
		$N_{x} = 3$ and $N_{y} = 2$, where each point has an associated index. This index may represent
		$i$ or $j$, that are associated with observation points $(x_{i}, y_{i}, z_{0})$ and 
		equivalent sources $(x_{j}, y_{j}, z_{c})$. Left panel shows an example of $x$-oriented grid,
		with indices varying along $x$-axis, while right panel shows an example of $y$-oriented grid, 
		with indices varying along $y$-axis.}
	\label{fig:regular-grids}
}

%\plot{4_equivalent_sources}{width=\textwidth}{
%	{Representation of the four equivalent sources (black dots) needed to reconstruct the non-symmetric matrix $\mathbf{A}$ (equation \ref{eq:aij_mag}). Each of the equivalent sources are located in the corner of the simulated regular grid of $M_x = 4$ and $M_y = 3$ sources. The influence of these sources on each of the observation points (blue dots) i the regular grid of $N_x = 4$ and $N_y = 3$ will give the four columns necessary of matrix $\mathbf{A}$.}
%	\label{fig:4_equivalent_sources}
%}

%% Computational performance

\plot{flops_mag}{width=\textwidth}{
	{Number of flops associated with classical method (equation \ref{eq:flops-classical-method}), 
	the standard CGLS method (equation \ref{eq:flops-standard-cgls}) and our method (equation 
	\ref{eq:flops-convolutional-method}, all of them with $N^{it} = 50$. 
	The number of observation points $N$ varies from $5,000$ to $1,000,000$.}
	\label{fig:flops}
}

\plot{time_comparison_mag}{width=\textwidth}{
	{Comparison between the runtime of the equivalent-layer technique using the classical method, 
	standard CGLS method and our method. The values for the standard CGLS and our method use
	$N^{it} = 50$ iterations.}
	\label{fig:solve_time}
}

%\plot{time_sources_mag}{width=\textwidth}{
%	{Comparison between the runtime to calculate the first column of the BCCB matrix embbeded from $\mathbf{A}$ (equation \ref{eq:aij_mag}) using only one and using four equivalent sources. Although the time is very similar, with one source a small advantage can be observed as the number of data $N$ increases. This test was done from $N = 10,000$ to $N = 700,000$ with increases of $5,625$ observation points.}
%	\label{fig:sources_time}
%}

%% Synthetic data part I

\plot{synthetic_data_comparison_v2}{width=9cm}{
{Synthetic tests: the simulated airborne magnetic surveys  - 
The first row shows the grids of observation points and the undulating observation surfaces that simulate the airborne magnetic surveys. 
The second row shows the noise-corrupted total-field anomalies produced by the synthetic sources and calculated on the simulated airborne magnetic survey shown in the first row. 
The third row shows the  noise-free total-field anomalies produced by the synthetic sources 
at $z = -1,300$ m (the true upward-continued total-field anomalies).
The fourth row shows the noise-free total-field anomalies produced by the synthetic sources at inclination $I_{0} = 90\circ$ (the true reduced to pole total-field anomalies).
The results shown in these last three rows were obtained by using the simulated airborne magnetic surveys as follows:
(a) A regular grid of $100 \times 50$ observation points in the $x-$ and $y-$directions and a flat observation surface at $z= -900$ m. 
An irregular grid with uncertainties of (b) $20\%$ and (c) $30\%$   in the $x-$ and $y-$coordinates and a flat observation surface at $z= - 900$ m . 
A regular grid  of $100 \times 50$ observation points in the $x-$ and $y-$coordinates and an undulating observation surface with uncertainties of (d) $5\%$ and  (e) $10\%$.
The black lines represent the horizontal projection of the sources
.}
\label{fig:synthetic_data_comparison_v2}
}

\plot{synthetic_residuals_convergence_comparison_v2}{width=\textwidth}{
{Synthetic tests: the data residuals and convergence - 
The first row shows the data residuals using the classical method.
The second and third rows show, respectively, the data residuals and the convergence curves using the convolutional equivalent layer (our method).
The results shown in these three rows were obtained by using the simulated airborne magnetic surveys shown in Figure \ref{fig:synthetic_data_comparison_v2}, i.e.:
(a) A regular grid of $100 \times 50$ observation points in the $x-$ and $y-$directions and a flat observation surface at $z= -900$ m. 
An irregular grid with uncertainties of (b) $20\%$ and (c) $30\%$   in the $x-$ and $y-$coordinates and a flat observation surface at $z= - 900$ m . 
A regular grid  of $100 \times 50$ observation points in the $x-$ and $y-$coordinates and an undulating observation surface with uncertainties of (d) $5\%$ and  (e) $10\%$.
The black lines represent the horizontal projection of the sources
.}
\label{fig:synthetic_residuals_convergence_comparison_v2}
}


\plot{synthetic_upward_residuals_comparison_v2}{width=\textwidth}{
{Synthetic tests: the data residuals of the upward-continued total-field anomalies (third row 
in Figure \ref{fig:synthetic_data_comparison_v2}).
The data residuals of the upward-continued total-field anomalies are defined as the difference between 
the noise-free total-field anomaly produced by the synthetic sources at $z = -1,300$ m 
(third  row in Figure \ref{fig:synthetic_data_comparison_v2}) and
the predicted total-field anomaly at $z = -1,300$ m  obtained by using three methods:
the classical method (first row); the convolutional equivalent layer (second row); and 
the classic approach in the Fourier domain (third row).
The results shown in these three rows were obtained by using the simulated airborne magnetic surveys shown in Figure \ref{fig:synthetic_data_comparison_v2}, i.e.:
(a) A regular grid of $100 \times 50$ observation points in the $x-$ and $y-$directions and a flat observation surface at $z= -900$ m. 
An irregular grid with uncertainties of (b) $20\%$ and (c) $30\%$   in the $x-$ and $y-$coordinates and a flat observation surface at $z= - 900$ m . 
A regular grid  of $100 \times 50$ observation points in the $x-$ and $y-$coordinates and an undulating observation surface with uncertainties of (d) $5\%$ and  (e) $10\%$.
The black lines represent the horizontal projection of the sources
.}
\label{fig:synthetic_upward_residuals_comparison_v2}
}

\plot{synthetic_zrtp_residuals_comparison_v2}{width=\textwidth}{
{Synthetic tests: the data residuals of the reduced to pole total-field anomalies (fourth row 
in Figure \ref{fig:synthetic_data_comparison_v2}).
The data residuals of the reduced to pole total-field anomalies are defined as the difference between 
the noise-free total-field anomaly produced by the synthetic sources at the pole (fourth  row in Figure \ref{fig:synthetic_data_comparison_v2}) and the predicted total-field anomaly obtained by using three methods:
the classical method (first row); the convolutional equivalent layer (second row); and 
the classic approach in the Fourier domain (third row).
The results shown in these three rows were obtained by using the simulated airborne magnetic surveys shown in Figure \ref{fig:synthetic_data_comparison_v2}, i.e.:
(a) A regular grid of $100 \times 50$ observation points in the $x-$ and $y-$directions and a flat observation surface at $z= -900$ m. 
An irregular grid with uncertainties of (b) $20\%$ and (c) $30\%$   in the $x-$ and $y-$coordinates and a flat observation surface at $z= - 900$ m . 
A regular grid  of $100 \times 50$ observation points in the $x-$ and $y-$coordinates and an undulating observation surface with uncertainties of (d) $5\%$ and  (e) $10\%$.
The black lines represent the horizontal projection of the sources
.}
	\label{fig:synthetic_zrtp_residuals_comparison_v2}
}

%% Field Data

\plot{carajas_residuals_comparison_edit}{width=\textwidth}{
	{(a) Observed total-field anomaly over the Carajás Province, northen Brazil. The aeromagnetic survey was flown in $131$ north-south flight lines at an average altitude of $900$ m, totaling $N = 6,081,345$ observation points.
	 (b) Data residuals, defined as the difference between the regular interpolated grid data (not shown) and the predicted data (not shown), with mean of $0.0762$ nT and standard deviation of $0.4886$ nT. 
 	 (c) Data residuals, defined as the difference between the irregular decimated grid data (not shown) and the predicted data (not shown), with mean of $ 0.0717$ nT and standard deviation of $0.3144$ nT.
     (d) Convergence curve using our method to the decimated irregular grid of the real data of Carajás Province, Brazil.}
	\label{fig:carajas_residuals_comparison}
}

\plot{carajas_upward_comparison_1200_uni}{width=13cm}{
	{Upward continuations of real data of Carajás Province, Brazil at altitude of 5,000 m by using:
	(a) the convolutional equivalent layer (our method) and (b) the classical Fourier method.}
	\label{fig:carajas_upward_comparison}
}

%\plot{carajas_real_data_mag}{width=\textwidth}{
%	{Observed total-field anomaly over the Carajás Province, northen Brazil. The aeromagnetic survey was flown in $131$ north-south flight lines at an average altitude of $900$ m, totaling $N = 6,081,345$ observation points.}
%	\label{fig:carajas_real_data_mag}
%}
%
%\plot{carajas_real_data_decimated_gridline}{width=8cm}{
%	{Observed total-field anomalies over the Carajás Province, northen Brazil, considering: 
%	(a) a regular grid ($10,000 \times 131$, totaling $N = 1,310,000$ observation points) of interpolated values from the original irregularly sampled data (Figure \ref{fig:carajas_real_data_mag}); and  	
%	(b) an irregular grid ($10,000 \times 131$, totaling $N = 1,310,000$ observation points) of decimated values from the the original irregularly sampled data (Figure \ref{fig:carajas_real_data_mag}).}
%	\label{fig:carajas_real_data_decimated_gridline}
%}
%
%\plot{carajas_tf_predicted_gridline}{width=8cm}{
%	{Results using our method applied to the interpolated $10,000 \times 131$ regular grid
%	(Figure \ref{fig:carajas_real_data_decimated_gridline}a) - 
%	(a) Predicted data and (b) Data residuals, defined as the difference between the observed 
%	(Figure \ref{fig:carajas_real_data_decimated_gridline}a) and the predicted data (panel a), with mean of $0.0762$ nT and standard deviation of $0.4886$ nT.}
%	\label{fig:carajas_gz_predito_mag_gridline}
%}
%
%\plot{carajas_tf_predicted_decimated}{width=8cm}{
%	{Results using our method applied to the decimated  $10,000 \times 131$ irregular grid
%	(Figure \ref{fig:carajas_real_data_decimated_gridline}b) - 	
%	(a) Predicted data and (b) Data residuals, defined as the difference between the observed  (Figure \ref{fig:carajas_real_data_decimated_gridline}b) and the predicted data (panel a), with mean of $ 0.0717$ nT and standard deviation of $0.3144$ nT.}
%	\label{fig:carajas_gz_predito_mag_decimated}
%}
%
%\plot{convergence_carajas_mag_decimated}{width=\textwidth}{
%	{Convergence curve using our method to the decimated irregular grid of the real data of Carajás Province, Brazil.}
%	\label{fig:convergence_carajas_mag_decimated}
%}
%
%\plot{up5000_carajas_mag_decimated}{width=\textwidth}{
%	{Upward continuation transformation of real data of Carajás Province, Brazil at $5, \,000$ m after $2.64$ seconds.}
%	\label{fig:up5000_carajas_decimated_mag}
%}

