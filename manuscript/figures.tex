\renewcommand{\figdir}{Fig} % figure directory

%% Methodology
\plot{Figure1}{width=\textwidth}{
	{Schematic representation of an $N_{x} \times N_{y}$ regular grid of points (black dots) defined by 
	$N_{x} = 4$ and $N_{y} = 3$. The grids are oriented along the (a) $x$-axis and (b) $y$-axis. The grid 
	coordinates are $x_{k}$ and $y_{k}$, where the $k = 1, \dots, N_{x}$ and $l = 1, \dots, N_{y}$ are 
	called the grid indices. The insets show the grid indices $k$ and $l$.}
	\label{fig:methodology}
}

\plot{4_equivalent_sources}{width=\textwidth}{
	{Representation of the four equivalent sources (black dots) needed to reconstruct the non-symmetric matrix $\mathbf{A}$ (equation \ref{eq:aij_mag}). Each of the equivalent sources are located in the corner of the simulated regular grid of $M_x = 4$ and $M_y = 3$ sources. The influence of these sources on each of the observation points (blue dots) i the regular grid of $N_x = 4$ and $N_y = 3$ will give the four columns necessary of matrix $\mathbf{A}$.}
	\label{fig:4_equivalent_sources}
}

%% Computational performance

\plot{flops_mag}{width=\textwidth}{
	{Number of flops necessary to estimate the parameter vector $\mathbf{\hat{p}}$ using the non-iterative classical method (equation \ref{eq:flops-normal-cholesky}) the CGLS (equation \ref{eq:flops-cgls}) and our modified CGLS method (equation \ref{eq:flops-cgls-bccb}) with $N^{it} = 50$. 
	The observation point $N$ varied from $5,000$ to $1,000,000$. The \emph{radix-2} 2D FFT
	algorithm was considered for our method, with $\kappa = 5$.}
	\label{fig:flops}
}

\plot{time_comparison_mag}{width=\textwidth}{
	{Comparison between the runtime of the equivalent-layer technique using the classical, the CGLS algorithm and our method.	The values for the CGLS and our methods were obtained for $N^{it} = 50$ iterations.}
	\label{fig:solve_time}
}

\plot{time_sources_mag}{width=\textwidth}{
	{Comparison between the runtime to calculate the first column of the BCCB matrix embbeded from $\mathbf{A}$ (equation \ref{eq:aij_mag}) using only one and using four equivalent sources. Although the time is very similar, with one source a small advantage can be observed as the number of data $N$ increases. This test was done from $N = 10,000$ to $N = 700,000$ with increases of $5,625$ observation points.}
	\label{fig:sources_time}
}

%% Synthetic data part I

\plot{model_mag_synthetic}{width=\textwidth}{
	{Observed synthetic magnetic field data. A regular grid of $80 \times 80$ points was used, totaling $N = 6,\, 400$ observation points. Three bodies were modeled: two prisms and a sphere with inclination, declination and intensity of $0^{\circ}$ and $45^{\circ}$ and $2\times\sqrt{2}$ A/m, respectively.}
	\label{fig:model_mag_synthetic}
}

\plot{predicted_synthetic_mag}{width=8cm}{
	{(a) Predicted data using a classical linear inversion method (equation \ref{eq:estimated-p-parameter-space}). (b) Residuals between the observed (\ref{fig:model_mag_synthetic}) and the predicted data (panel a), with mean $0.3712$ nT and standart deviation of $0.2798$ nT. This process took $17.6$ seconds.}
	\label{fig:predicted_synthetic_mag}
}

\plot{predicted_bccb_mag}{width=8cm}{
	{(a) Predicted data using the CGLS method with the fast BTTB matrix-vector product. (b) Residuals between the observed (\ref{fig:model_mag_synthetic}) and the predicted data (panel a), with mean $0.5150$ nT and standart deviation of $0.4363$ nT. This process took $0.18$ seconds.}
	\label{fig:predicted_bccb_mag}
}

\plot{convergence_synthetic_mag}{width=\textwidth}{
	{Convergence analysis of the CGLS method for this synthetic application of the magnetic equivalent layer using the fast BTTB matrix-vector product.}
	\label{fig:convergence_synthetic_mag}
}

%% Synthetic data part II

\plot{model_mag_synthetic_irregular_10}{width=8cm}{
	{(a) Synthetic magnetic field grid visualization. A irregular grid of $100 \times 50$ points was used, totaling $N = 5,\, 000$ observation points. Standart deviations of $10\%$ in the $x$-direction and $10\%$ in the $y$-direction were applied. (b) Observed synthetic magnetic field data using this irregular grid in panel a. Three bodies were modeled: two prisms and a sphere with inclination, declination and intensity of $0^{\circ}$ and $45^{\circ}$ and $2\times\sqrt{2}$ A/m, respectively.}
	\label{fig:model_mag_synthetic_irregular_10}
}

\plot{predicted_synthetic_mag_irregular_10}{width=8cm}{
	{(a) Predicted data using a classical linear inversion method (equation \ref{eq:estimated-p-parameter-space}) for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_10}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_10}b) and the predicted data (panel a), with mean $0.3628$ nT and standart deviation of $0.2727$ nT.}
	\label{fig:predicted_synthetic_mag_irregular_10}
}

\plot{predicted_bccb_mag_irregular_10}{width=8cm}{
	{(a) Predicted data using the CGLS method with the fast BTTB matrix-vector product for for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_10}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_10}b) and the predicted data (panel a), with mean $0.6024$ nT and standart deviation of $0.4998$ nT.}
	\label{fig:predicted_bccb_mag_irregular_10}
}

\plot{convergence_synthetic_mag_irregular_10}{width=\textwidth}{
	{Convergence analysis of the CGLS method for the synthetic application of the magnetic equivalent layer using an irregular grid with $10\%$ of pertubation on the $x$-\textit{direction} and $y$-\textit{direction}.}
	\label{fig:convergence_synthetic_mag_irregular_10}
}

%
%

\plot{model_mag_synthetic_irregular_20}{width=8cm}{	
	{(a) Synthetic magnetic field grid visualization. A irregular grid of $100 \times 50$ points was used, totaling $N = 5,\, 000$ observation points. Standart deviations of $20\%$ in the $x$-direction and $20\%$ in the $y$-direction were applied. (b) Observed synthetic magnetic field data using this irregular grid in panel a. Three bodies were modeled: two prisms and a sphere with inclination, declination and intensity of $0^{\circ}$ and $45^{\circ}$ and $2\times\sqrt{2}$ A/m, respectively.}
	\label{fig:model_mag_synthetic_irregular_20}
}

\plot{predicted_synthetic_mag_irregular_20}{width=8cm}{	
	{(a) Predicted data using a classical linear inversion method (equation \ref{eq:estimated-p-parameter-space}) for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_20}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_20}b) and the predicted data (panel a), with mean $0.3630$ nT and standart deviation of $0.2731$ nT.}
	\label{fig:predicted_synthetic_mag_irregular_20}
}

\plot{predicted_bccb_mag_irregular_20}{width=8cm}{	
	{(a) Predicted data using the CGLS method with the fast BTTB matrix-vector product for for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_20}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_20}b) and the predicted data (panel a), with mean $0.7147$ nT and standart deviation of $0.5622$ nT.}
	\label{fig:predicted_bccb_mag_irregular_20}
}

\plot{convergence_synthetic_mag_irregular_20}{width=\textwidth}{	
	{Convergence analysis of the CGLS method for the synthetic application of the magnetic equivalent layer using an irregular grid with $20\%$ of pertubation on the $x$-\textit{direction} and $y$-\textit{direction}.}
	\label{fig:convergence_synthetic_mag_irregular_20}
}

%
%

\plot{model_mag_synthetic_irregular_30}{width=8cm}{
	{(a) Synthetic magnetic field grid visualization. A irregular grid of $100 \times 50$ points was used, totaling $N = 5,\, 000$ observation points. Standart deviations of $30\%$ in the $x$-direction and $30\%$ in the $y$-direction were applied. (b) Observed synthetic magnetic field data using this irregular grid in panel a. Three bodies were modeled: two prisms and a sphere with inclination, declination and intensity of $0^{\circ}$ and $45^{\circ}$ and $2\times\sqrt{2}$ A/m, respectively.}
	\label{fig:model_mag_synthetic_irregular_30}
}

\plot{predicted_synthetic_mag_irregular_30}{width=8cm}{	
	{(a) Predicted data using a classical linear inversion method (equation \ref{eq:estimated-p-parameter-space}) for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_30}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_30}b) and the predicted data (panel a), with mean $0.3634$ nT and standart deviation of $0.2735$ nT.}
	\label{fig:predicted_synthetic_mag_irregular_30}
}

\plot{predicted_bccb_mag_irregular_30}{width=8cm}{	
	{(a) Predicted data using the CGLS method with the fast BTTB matrix-vector product for for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_30}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_30}b) and the predicted data (panel a), with mean $0.9788$ nT and standart deviation of $0.7462$ nT.}
	\label{fig:predicted_bccb_mag_irregular_30}
}

\plot{convergence_synthetic_mag_irregular_30}{width=\textwidth}{
	{Convergence analysis of the CGLS method for the synthetic application of the magnetic equivalent layer using an irregular grid with $30\%$ of pertubation on the $x$-\textit{direction} and $y$-\textit{direction}.}
	\label{fig:convergence_synthetic_mag_irregular_30}
}

%
%

\plot{model_mag_synthetic_irregular_z5_undulating}{width=8cm}{ 
	{(a) Undulating surface where the total-field anomaly was computed. A irregular grid of $100 \times 50$ points was used, totaling $N = 5,\, 000$ observation points. A standart deviation of $5\%$ in the $z$-direction was applied. (b) Observed synthetic magnetic field data using this irregular grid in panel a. Three bodies were modeled: two prisms and a sphere with inclination, declination and intensity of $0^{\circ}$ and $45^{\circ}$ and $2\times\sqrt{2}$ A/m, respectively.}
	\label{fig:model_mag_synthetic_irregular_z5}
}

\plot{predicted_synthetic_mag_irregular_z5}{width=8cm}{
	{(a) Predicted data using a classical linear inversion method (equation \ref{eq:estimated-p-parameter-space}) for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_z5}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_z5}b) and the predicted data (panel a), with mean $0.3712$ nT and standart deviation of $0.2870$ nT.}
	\label{fig:predicted_synthetic_mag_irregular_z5}
}

\plot{predicted_bccb_mag_irregular_z5}{width=8cm}{
	{(a) Predicted data using the CGLS method with the fast BTTB matrix-vector product for for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_z5}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_z5}b) and the predicted data (panel a), with mean $0.9542$ nT and standart deviation of $0.8943$ nT.}
	\label{fig:predicted_bccb_mag_irregular_z5}
}

\plot{convergence_synthetic_mag_irregular_z5}{width=\textwidth}{
	{Convergence analysis of the CGLS method for the synthetic application of the magnetic equivalent layer using an irregular grid with $5\%$ of pertubation on the $z$-\textit{direction}.}
	\label{fig:convergence_synthetic_mag_irregular_z5}
}

%
%


\plot{model_mag_synthetic_irregular_z10_undulating}{width=8cm}{
	{(a) Undulating surface where the total-field anomaly was computed. A irregular grid of $100 \times 50$ points was used, totaling $N = 5,\, 000$ observation points. A standart deviation of $10\%$ in the $z$-direction was applied. (b) Observed synthetic magnetic field data using this irregular grid in panel a. Three bodies were modeled: two prisms and a sphere with inclination, declination and intensity of $0^{\circ}$ and $45^{\circ}$ and $2\times\sqrt{2}$ A/m, respectively.}
	\label{fig:model_mag_synthetic_irregular_z10}
}

\plot{predicted_synthetic_mag_irregular_z10}{width=8cm}{
	{(a) Predicted data using a classical linear inversion method (equation \ref{eq:estimated-p-parameter-space}) for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_z10}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_z10}b) and the predicted data (panel a), with mean $0.3865$ nT and standart deviation of $0.3216$ nT.}
	\label{fig:predicted_synthetic_mag_irregular_z10}
}

\plot{predicted_bccb_mag_irregular_z10}{width=8cm}{
	{(a) Predicted data using the CGLS method with the fast BTTB matrix-vector product for for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_z10}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_z10}b) and the predicted data (panel a), with mean $1.6105$ nT and standart deviation of $1.6231$ nT.}
	\label{fig:predicted_bccb_mag_irregular_z10}
}

\plot{convergence_synthetic_mag_irregular_z10}{width=\textwidth}{
	{Convergence analysis of the CGLS method for the synthetic application of the magnetic equivalent layer using an irregular grid with $10\%$ of pertubation on the $z$-\textit{direction}.}
	\label{fig:convergence_synthetic_mag_irregular_z10}
}

%
%

\plot{model_mag_synthetic_irregular_z20_undulating}{width=8cm}{
	{(a) Undulating surface where the total-field anomaly was computed. A irregular grid of $100 \times 50$ points was used, totaling $N = 5,\, 000$ observation points. A standart deviation of $20\%$ in the $z$-direction was applied. (b) Observed synthetic magnetic field data using this irregular grid in panel a. Three bodies were modeled: two prisms and a sphere with inclination, declination and intensity of $0^{\circ}$ and $45^{\circ}$ and $2\times\sqrt{2}$ A/m, respectively.}
	\label{fig:model_mag_synthetic_irregular_z20}
}

\plot{predicted_synthetic_mag_irregular_z20}{width=8cm}{
	{(a) Predicted data using a classical linear inversion method (equation \ref{eq:estimated-p-parameter-space}) for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_z20}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_z20}b) and the predicted data (panel a), with mean $0.4155$ nT and standart deviation of $0.4005$ nT.}
	\label{fig:predicted_synthetic_mag_irregular_z20}
}

\plot{predicted_bccb_mag_irregular_z20}{width=8cm}{
	{(a) Predicted data using the CGLS method with the fast BTTB matrix-vector product for for the irregular grid in figure \ref{fig:model_mag_synthetic_irregular_z20}a. (b) Residuals between the observed (\ref{fig:model_mag_synthetic_irregular_z20}b) and the predicted data (panel a), with mean $6.6220$ nT and standart deviation of $5.901$ nT.}
	\label{fig:predicted_bccb_mag_irregular_z20}
}

\plot{convergence_synthetic_mag_irregular_z20}{width=\textwidth}{
	{Convergence analysis of the CGLS method for the synthetic application of the magnetic equivalent layer using an irregular grid with $20\%$ of pertubation on the $z$-\textit{direction}.}
	\label{fig:convergence_synthetic_mag_irregular_z20}
}

%% Field Data

\plot{carajas_real_data_mag}{width=\textwidth}{
	{Observed magnetic field data of the Carajás, Brazil area. A regular grid of $500 \times 500$ points was used, totaling $N = 250,\, 000$ observation points.}
	\label{fig:carajas_real_data_mag}
}

\plot{carajas_tf_predito_500x500}{width=8cm}{
	{(a) Predicted data using our method. (b) Residuals between the observed (\ref{fig:carajas_real_data_mag}) and the predicted data (panel a), with mean $2.4566\times 10^{-07}$ nT and standart deviation of $1.9787\times 10^{-06}$ nT.}
	\label{fig:carajas_gz_predito_mag}
}
\plot{convergence_carajas_mag_500x500}{width=\textwidth}{
	{Convergence analysis of the CGLS method for the field data of Carajás, Brazil using the magnetic equivalent layer with a regular grid of $500 \times 500$ points.}
	\label{fig:convergence_carajas_mag_500x500}
}

\plot{up5000_carajas_mag_500x500}{width=\textwidth}{
	{Upward continuation transformation of real data of Carajás, Brazil at $5000$ meter. It was necessary $0.49$ seconds to complete the process.}
	\label{fig:up5000_carajas_500x500_mag}
}